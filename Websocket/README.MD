# مقدمه
# تاریخچه
# پروتکل ارتباطی
می‌خواهیم درباره‌ی نحوه‌ی ارتباط برقرار کردن و پیام‌های رد بدل شده در این پروتکل وبساکت حرف بزنیم.
این اطلاعات با استفاده از برنامه‌ی
[wireshark](https://www.wireshark.org/)
برای
capture
کردن پکت‌های وبساکت و برنامه‌ی
[websocat](https://github.com/vi/websocat)
برای ایجاد کلاینت و سرور بدست آورده شده‌اند.

در اولین پکت کلاینت به سرور صرفا از پروتکل
HTTP
استفاده می‌کنیم. به کمک این موضوع می‌توانیم کوکی یا هدر‌های خود را در کلاینت در اولین پیام
handshake
قرار دهیم و صرفا حتی قبل از اولین پیام ما، سرور بتواند این هدر‌ها را بخواند و مثلا به کمک آن‌ها کسی را
authorize
کند یا یوزر آیدی کسی را پیدا کند.
همچنین می‌توان به کمک
headerها
دیتاهای دیگر نظیر تنظیمات داده‌هایی که قرار است در وبساکت فرستاده شود یا دریافت شود را قبل از اولین داده سمت سرور فرستاد. یک نمونه از اولین پکت
websocket hello
را می‌توانید در زیر مشاهده کنید:

```
GET / HTTP/1.1
Host: 127.0.0.1:36215
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Version: 13
Sec-WebSocket-Key: nQUNu5i0IAAsAQ1SJ814+Q==
```

در خط اول همان طور که مشاهده می‌شود، صرفا گفته‌ایم که می‌خواهیم آدرس
/
را با پروتکل
HTTP/1.1،
GET
کنیم. مثل یک ریکوئست عادی
HTTP!
 علاوه بر هدر
`Host`
که صرفا دامنه‌ی جایی که می‌خواهیم به آن دسترسی پیدا کنیم را مشخص می‌کند، یک سری هدر‌های خاص
websocket
نیز در این پکت وجود دارند.

هدر‌های
`Connection`
و
`Upgrade`
همیشه باید مقادیر
`Upgrade`
و
`websocket`
را داشته باشند.
هدر
`Sec-WebSocket-Version`
ورژن وبساکت را مشخص می‌کند که می‌تواند عدد‌های مختلفی باشد ولی در حال حاضر 13 آخرین ورژن آن است. لیست ورژن‌های آن را می‌تواند از
[اینجا](https://www.iana.org/assignments/websocket/websocket.xml#version-number)
مشاهده کنید.
آخرین هدر
`Sec-WebSocket-Key`
است که صرفا یک دنباله‌ی تصادفی از 16 بایت است که
base64 encoded
شده‌اند. به کمک تمام این 4 هدر سرور متوجه می‌شود که یک کانکشن
valid HTTP
قرار است که برقرار شود.

در ادامه سرور این پکت را در جواب پکت اول می‌فرستد:
```
HTTP/1.1 101 Switching Protocols
Sec-WebSocket-Accept: 8CWk7Sb3eBr5xjSXrWqXILHWrTU=
Connection: Upgrade
Upgrade: websocket
```

همان طور که می‌بینید
status code
درخواست
HTTP
ما
101
است که نشان می‌دهد که قرار است که پروتکل ارتباطی را از
HTTP
به چیز دیگری عوض کنیم. همین طور که از هدر‌های سرور معلوم است، قرار است که پروتکل ارتباطی به وبساکت تغییر یابد!


# مثالی در دنیای واقعی
# پیاده سازی یک برنامه چت ساده
