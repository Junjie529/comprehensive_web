<p align="center">
    <img src="https://github.com/AryanAhadinia/web_workshop/blob/redis_article/Redis/public/redis_logo.svg" alt="Redis Logo">
</p>

<p align="center">
    تحقیق پایانی برنامه سازی وب، دانشگاه صنعتی شریف
    <br/>
    ارائه دهنده درس: جناب آقای امید جعفری نژاد
    <br/>
    نویسندگان: آرین احدی نیا، محمد جعفری، پوریا ممتاز اصفهانی
</p>

<div dir="rtl">

## ردیس چیست؟

ردیس یک انبار در حافظه داده ساختار (in-memory data structure store) است که میتواند به عنوان پایگاه داده یا حافظه نهان (cache) یا کارگزار پیام (message broker) استفاده شود.
ردیس داده ساختار هایی را از قبیل رشته (strings)، هش (hashes)، لیست (lists)، مجموعه (sets)، مجموعه مرتب (sorted sets)، بیتمپ (bitmaps)، جریان ها (streams) و ... ارائه میدهد.
ردیس، مجموعه ای از امکانات دخلی از قبیل تکرر (replication)، اسکیریپ نویسی لوآ (Lua scripting)، تخلیه LRU و ... را ارائه میدهد.

ردیس در خانواده پایگاه داده های کلید-مقدار (key-value) قرار میگیرد.
از آنجایی که ردیس رویه کلید-مقداری دارد. اغلب به عنوان یک داده ساختار معرفی میشود.

## متن باز

خبر خوب اینکه ردیس یک پروژه متن باز است و شما می توانید به متن منبع این پروژه در GitHub دسترسی پیدا کنید.
[github.com/redis](https://github.com/redis)

## نصب ردیس

روش های مختلفی برای نصب ردیس وجود دارد. در این مقاله، ما به نصب ردیس در داکر، در لینوکس و در ویندوز اشاره می کنیم.
اگر شما یک توسعه دهنده هستید و میخواهید از ردیس برای اجرا و تست پروژه خود استفاده کنید، قویا استفاده از داکر را به شما توصیه می کنیم.

### نصب در لینوکس

برای نصب در لینوکس روش های متعددی وجود دارد. ما در اینجا یک روش نصب و ایمن‌سازی آن را برای سرور های ubuntu بیان می کنیم. هرچند که از این روش برای نصب در ubuntu lts نیز میتوانید استفاده کنید.

#### پیشنیاز ها

شما برای طی مراحل این نصب، به یک ubuntu server و دسترسی sudo نیاز دارید.

#### مراحل

1. با استفاده از دستور زیر، ردیس و dependencies هایش را نصب کنید.

<div dir="ltr">

```
$ sudo apt update
$ sudo apt install redis-server
```

</div>

2. با استفاده از دستور زیر فایل config ردیس را باز کنید.

<div dir="ltr">

```
$ sudo nano /etc/redis/redis.conf
```

</div>

یک فایل مشابه تصویر زیر باز خواهد شد. مقابل `supervised` عبارت `no` نوشته شده است. آن را به `systemd` تغییر دهید.
این تغییر اجازه میدهد که سیستم به بتواند به عنوان یک سرویس با ردیس برخورد کند.

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis_article/Redis/public/ubuntu/ubuntu_1.png" alt="ubuntu_1">

3. برای اعمال تغییرات اعمال شده در مرحله قبل دستور زیر را اجرا کنید.

<div dir="ltr">

```
$ sudo systemctl restart redis.service
```

</div>

4. حال میتوانید با استفاده از دستور زیر به redis-cli وصل شوید.

<div dir="ltr">

```
$ redis-cli
```

</div>

5. برای تست می توانید از دستور `ping` استفاده کنید. پاسخ مورد انتظار در صورت اجرای مناسب، `PONG` خواهد بود.

<div dir="ltr">

```
> ping
PONG
```

</div>

6. با استفاده از دستور `exit` میتوانید خارج شوید.

<div dir="ltr">

```
> exit
```

</div>

7. در صورتی که تمایل به تنظیم رمزعبور برای ردیس دارید، این بخش را دنبال کنید.
تنظیم رمزعبور یکی از دو قابلیت امنیتی ردیس است که کاربران را ملزم می کند برای دسترسی به آن، با استفاده از رمز عبور احراز هویت کنند. رمز عبور از طریق فایل `config` ردیس تنظیم میشود. برای تنظیم رمز عبور، فایل `config` را با استفاده از دستور زیر باز کنید.

<div dir="ltr">

```
$ sudo nano /etc/redis/redis.conf
```

</div>

اسکرول کنید تا به بخش `SECURITY` برسید. در آنجا یک خط کامنت شده به شکل زیر وجود دارد.

<div dir="ltr">

```
# requirepass foobared
```

</div>

برای تنظیم رمزعبور، با حذف # آن را از حالت کامنت دربیاورید و عبارت foobared را با یک رمز عبور امن جایگزین کنید.

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis_article/Redis/public/ubuntu/ubuntu_2.png" alt="ubuntu_2">

##### توجه

در همین قسمت، مطابق تصویر بالا نوشته شده است که به علت سرعت بالای ردیس، کاربران خارجی با بسامد 150k تلاش در ثانیه، میتوانند پسورد ها را تولید و امتحان کنند.
این موضوع خطر حمله جستوجوی کور را بالا می برد.
لذا توصیه میشود که از یک پسورد طولانی که ترکیب حروف و اعداد و نماد است استفاده کنید.
برای اینکار می توانید از نرم‌افزار های تولید رشته های تصادفی مانند `open ssl` استفاده کنید.

پس از تنظیم رمزعبور، تغییرات را ذخیره و فایل را ببندید و از دستور زیر برای اعمال تغییرات استفاده کنید.

<div dir="ltr">

```
$ sudo systemctl restart redis.service
```

</div>

اکنون ردیس تنها پس از احراز هویت با رمزعبور، کار خواهد کرد. مثال:

<div dir="ltr">

```
$ redis-cli
> set key 1
(error) NOAUTH Authentication required.
> auth 1234
OK
> set key 1
OK
quit
```

</div>

8. این یک قابلیت امنیتی برای تغییر نام دستورهای خطرناک است. در صورتی که تمایلی به انجام آن ندارید، می توانید این بخش را دنبال نکنید.
یک قابلیت امنیتی دیگر که ردیس فراهم می آورد. تغییر نام یا غیر فعال کردن دستوراتی است که اجرای آنها میتواند خطرناک باشد.
اجرای این دستورها میتواند اتفاقی یا باشد یا توسط بدخواهان خارجی اتفاق بیفتد.

به عنوان مثال دستور زیر میتواند پسورد تنظیم شده را آشکار کند.

<div dir="ltr">

```
> config get requirepass
1) "requirepass"
2) "1234"
```

</div>

دستورهای لیست زیر از جمله دستورهای خطرناک هستند. هر چند که این لیست، جامع نیست.

<div dir="ltr">

```
FLUSHDB
FLUSHALL
KEYS
PEXPIRE
DEL
CONFIG
SHUTDOWN
BGREWRITEAOF
BGSAVE
SAVE
SPOP
SREM
RENAME
DEBUG
```

</div>

لیست کامل دستورهای ردیس را میتوانید از لینک روبرو دریافت کنید.
[http://redis.io/commands](http://redis.io/commands)

فراخور نیاز هر پروژه، میتوانید نام دستورهای خطرناک را به یک نام دلخواه تغییر دهید یا به صورت کلی اجرای آن دستور را غیر فعال کنید.
مشابه تنظیم رمزعبور، این کار از بخش `SECURITY` فایل تنظیم انجام میشود. کافیست که فایل مورد نظر را با استفاده از دستور زیر باز کنید.

<div dir="ltr">

```
$ sudo nano /etc/redis/redis.conf
```

</div>

سپس در بخش امنیت، مشابه تصویر زیر به بخش تغییر نام دستورات بروید. آنجا میتوانید دستورات تغییر نام را مشابه تصویر بنویسید.
توجه کنید که برای غیر فعال کردن، کافی است که نام آن را به یک رشته خالی تغییر دهید.

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis_article/Redis/public/ubuntu/ubuntu_3.png" alt="ubuntu_3">

### نصب در داکر

استفاده از این روش، به دلیل سادگی و سهولت قویا توصیه میشود. با طی مراحل زیر، میتوانید ردیس را در داکر خود نصب کنید.

#### پیشنیاز ها

1. command line
2. یک عدد داکر صحیح و سالم و در وضعیت running
3. کاربر با دسترسی admin در سیستم عامل (sudo و root در لینوکس)

#### مراحل

1. با استفاده از دستور زیر، یک کانینر ردیس با نام دلخواه باز کنید. در صورت لزوم میتوانید نسخه نصب را نیز مشخص کنید. در دستور زیر چون نسخه نصب را مشخص نکرده ایم، سیستم به صورت خودکار آخرین نسخه (latest) را نصب خواهد کرد.

<div dir="ltr">

```
docker run --name my-first-redis -d redis
```

</div>

در تصویر پایین، تصویر ترمینال پس از اجرای موفقیت آمیز این دستور قرار دارد.

2. دستور زیر را در ترمینال اجرا کنید تا مطابق تصویر، از صحت نصب و اجرای ردیس اطلاع پیدا کنید.

<div dir="ltr">

```
docker ps
```

</div>

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis_article/Redis/public/docker/docker_1.png" alt="docker_1">

تمام شد! ردیس شما آماده است. میتوانید از طریق دستورات زیر به redis-cli در کامندلاین دسترسی پیدا کنید.

3. از دستور زیر برای باز کردن redis-cli استفاده کنید.

<div dir="ltr">

```
docker exec -it my-first-redis sh
redis-cli
```

</div>

4. میتوانید از دستور `ping` برای بررسی وجود اتصال مناسب استفاده کنید. در صورتی که اتصال برقرار باشد پاسخ `PONG` دریافت خواهد شد.

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis_article/Redis/public/docker/docker_2.png" alt="docker_2">

5. ممکن است که به هر دلیلی بخواهید ردیس با فایل کانفیگ دلخواه شما اجرا شود. این دلایل میتوانند دلایل امنیتی باشند که در مرحله 7 و 8 نصب در لینوکس توضیح دادیم.
برای اجرای ردیس با فایل کانفیگ دلخواه، کافی است ردیس را با دستور زیر اجرا کنید.

<div dir="ltr">

```
sudo docker run --name my-first-redis -v /myfirstredis/redis.conf:/path/to/redis/redis.conf -d redis
```

</div>

## نصب در ویندوز

نصب ردیس در ویندوز سرراست است و صرفا با دانلود فایل اجرایی نصب، صورت می گیرد. استفاده از آن نیز بسیار آسان استو کافی است که فایل redis-server.exe را اجرا کنید. در نهایت میتوانید با استفاده از دستور `ping`، صحت اتصال را بررسی کنید.

<div dir="ltr">

```
> ping
PONG
```

</div>

</div>